{% extends 'base.html' %}


{% block main_content %}

<!-- NavBar & Searchbar using include -->
<div class="navbar-fixed {% if user.is_authenticated %} blue {% endif %}
  z-depth-2" style="background-color: #9EC4D5; width: 100%; height: 120px; position:
  fixed">
    {% include 'includes/navbar.html' %}
    <div class="nav-wrapper white z-depth-4 searchbaroffset roundedcorners bordersmall">
        {% include 'includes/searchbar_researcher.html' %}
    </div>

</div>

<div class="container-fixed transparent" style="margin-top: 180px; width: 100%">
    {% if has_found %}
    <div class="col s12 l3">
        <div class="card roundedcorners" style="padding: 16px; width: 100%;">

            <div class="container-fixed transparent" style="display:flex; justify-content: center;" ;>
                <div style="align-self: center;">
                    <h4 style="font-weight: 500;">
                        {{ author.first_name }} {{ author.last_name }}
                    </h4>
                </div>
                <div id="Total" style="align-self:center; padding-left: 20%;">
                    <h5 style="font-weight: 500;">Total: {{ author.get_number_of_publications }}
                        Publication{% if author.get_number_of_publications != 1 %}s
                        {% endif %}
                    </h5>
                </div>
            </div>

            <div class="container-fixed transparent" style="margin-top: 18px; width: 100%">

                <div class="container-fixed transparent" style="width: 100%; margin-top: 48px">
                    {% for competency in author.competencies %}
                    {% if user.is_authenticated or competency.competency_status != "Hidden" %}
                    <div class="col resultbox container l10  grey lighten-3 roundedcorners  z-depth-1">
                        <img src="/static/images/LightBulb.png" width="24px" height="24px" style="margin-left: 3%;">
                        <div class="resulttext col">
                            <p>
                                <a class="waves-effect btn-flat"
                                    style="margin-bottom: 2%; font-size: large;text-transform:capitalize;"
                                    href="/results/{{competency.id}}">{{competency.name}}</a>
                                {% if competency.competency_status == 'Validated' %}
                                <img src="/static/images/verified.png" width="24px" height="24px">
                                {% endif %}
                            </p>
                        </div>
                        {% if competency.ranking >= 0 %}
                            {% if competency.ranking <= 1 %} 
                            <div class="rankingbar">
                                <div class="indicator" style="left: calc({{competency.ranking}} * 100%)"></div>
                                <div class="tooltip">The ranking is calculated based on the average relevancy given by the ML model plus a bonus for multiple occurences. Ranking: {{competency.ranking}}
                                </div>
                            </div>
                        {%endif%}
                        {%endif%}

                    {% if user.is_authenticated %}
                    <div class="col" style="width: 130px">
                        <div class="row">
                            <form action="{% url 'change_status_researcher' %}" method="post">
                                {% csrf_token %}
                                <input type="hidden" name ="author_id" value="{{ author.id }}">
                                <input type="hidden" name ="competency_id" value="{{ competency.id }}">
                                <input type="hidden" name ="new_status" value="Hidden">
                                <button type="submit" class="material-icons status-button transparent {% if competency.competency_status == 'Hidden' %}clicked #e0e0e0 red lighten-2 roundedcorners{% endif %}">visibility_off</button>
                            </form>
                            <form action="{% url 'change_status_researcher' %}" method="post">
                                {% csrf_token %}
                                <input type="hidden" name ="author_id" value="{{ author.id }}">
                                <input type="hidden" name ="competency_id" value="{{ competency.id }}">
                                <input type="hidden" name ="new_status" value="Unvalidated">
                                <button type="submit" class="material-icons status-button transparent {% if competency.competency_status == 'Unvalidated' %}clicked #e0e0e0 grey lighten-2 roundedcorners{% endif %}">visibility</button>
                            </form>
                            <form action="{% url 'change_status_researcher' %}" method="post">
                                {% csrf_token %}
                                <input type="hidden" name ="author_id" value="{{ author.id }}">
                                <input type="hidden" name ="competency_id" value="{{ competency.id }}">
                                <input type="hidden" name ="new_status" value="Validated">
                                <button type="submit" class="material-icons status-button transparent {% if competency.competency_status == 'Validated' %}clicked #e0e0e0 green lighten-2 roundedcorners{% endif %}">check</button>
                            </form>
                        </div>
                    </div>
                    {% endif %}
                    <div class="infoboxresult col">
                        <div> {{ competency.get_last_publication_year }} </div>
                        <div> Last relevant publication </div>
                    </div>
                    <div class="resultcount col">
                        <div> {{ competency.get_number_of_publications }} </div>
                        <div> Relevant publication{% if competency.get_number_of_publications != 1 %}s
                            {% endif %} </div>
                    </div>


                    <button onclick="expand('{{ forloop.counter }}');"
                        class="btn-large btn-flat waves-effect transparent right-align roundedcorners">
                        <i class="medium material-icons">expand_more</i>
                    </button>
                </div>
                <div id="{{ forloop.counter }}" class="container" style="display: None">
                    <table class="highlight">
                        <thead>
                            <tr>
                                <th>Competency</th>
                                <th>Title</th>
                                <th>Type</th>
                                <th></th>
                                <th>Publicated</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for abstract in competency.abstracts %}

                            <tr>
                                <th class="competency" style="font-weight: normal">{{ competency.name }}</th>
                                <th style="font-weight: normal">{{ abstract.title }}</th>
                                <th style="font-weight: normal">{{ abstract.doctype }}</th>
                                <th>
                                    <a href="/abstract/{{abstract.id}}/detailed/{{author.id}}">
                                        <button class="buttonabstract btn-medium btn-flat waves-effect roundedcorners">
                                            View Abstract
                                        </button>
                                    </a>
                                </th>
                                <th style="font-weight: normal">{{ abstract.year }}</th>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <br>
                {% endif %}
                {% endfor %}
            </div>

        </div>
        {% else %}
        <div class="flow-text">
            No results for "{{ searched }}"
        </div>
        {% endif %}

    </div>
</div>
</div>
<script>
    function expand(tabContent) {
        status = window.getComputedStyle(document.getElementById(tabContent)).display
        if (status == "none") {
            document.getElementById(tabContent).style.display = 'block'
        } else {
            document.getElementById(tabContent).style.display = 'none'
        }

    }
</script>
{% endblock %}